# 15-Leafresh-CL
# â˜ï¸ Cloud Repository
**Leafreshì˜ í´ë¼ìš°ë“œ ìš´ì˜íŒ€ ë ˆí¬ì§€í† ë¦¬ì…ë‹ˆë‹¤**
- **AWS, GCP í´ë¼ìš°ë“œ**ë¥¼ ì´ìš©í•´ ìš´ì˜í•˜ê³  ìˆìœ¼ë©°,
- **ìˆ˜ë™ ë°°í¬ ë°©ì‹**ê³¼ **Githubë¥¼ ì´ìš©í•œ CI/CD**, **Terraformì˜ IaC ë°©ì‹**ì„ ë²„ì „ë³„ë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤!

> í”„ë¡œì íŠ¸ ìƒí™©ì— ë”°ë¼ ë””ë ‰í† ë¦¬ êµ¬ì¡° ë“± ë‚´ìš©ì´ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


<br>

---

## í´ë¼ìš°ë“œ ì•„í‚¤í…ì²˜




<br>

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
(root directory)
â”œâ”€â”€ performance-test
â”‚Â Â  â”œâ”€â”€ v1-bigbang
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ load_stress_k6.js
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ result.json
â”‚Â Â  â”‚Â Â  â””â”€â”€ result_stress.json
â”‚Â Â  â”œâ”€â”€ v2-docker
â”‚Â Â  â”‚Â Â  â””â”€â”€ init
â”‚Â Â  â””â”€â”€ v3-k8s
â”‚Â Â      â””â”€â”€ init
â”œâ”€â”€ README.md
â”œâ”€â”€ scripts
â”‚Â Â  â”œâ”€â”€ v1-bigbang
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ discord_notify.sh
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kill_process.sh
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ restart_servers.sh
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sftp_uploads.sh
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ show_log.sh
â”‚Â Â  â”‚Â Â  â””â”€â”€ start_servers.sh
â”‚Â Â  â””â”€â”€ v2-docker
â”‚Â Â      â”œâ”€â”€ cicd
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ ai-cicd.yml
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ be-cicd.yml
â”‚Â Â      â”‚Â Â  â””â”€â”€ fe-cicd.yml
â”‚Â Â      â”œâ”€â”€ docker-compose
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ docker-compose-be.yml
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ docker-compose-db.yml
â”‚Â Â      â”‚Â Â  â””â”€â”€ docker-compose-fe.yml
â”‚Â Â      â”œâ”€â”€ Dockerfile
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ Dockerfile-ai
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ Dockerfile-be
â”‚Â Â      â”‚Â Â  â””â”€â”€ Dockerfile-fe
â”‚Â Â      â””â”€â”€ nginx
â”‚Â Â          â”œâ”€â”€ default-be.conf
â”‚Â Â          â””â”€â”€ default-fe.conf
â””â”€â”€ terraform
    â”œâ”€â”€ v2-docker
    â”‚Â Â  â”œâ”€â”€ dev
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dev
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ modules
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ compute
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ be_startup.sh.tpl
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ db_startup.sh.tpl
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ fe_startup.sh.tpl
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ nginx
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ default_be.conf.tpl
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ default_fe.conf.tpl
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ default_vault.conf.tpl
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ docker-compose.tpl
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ vault_startup.sh.tpl
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ firewall
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ iam
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ memorystore
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ network
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ pubsub
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ service_accounts
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ output.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sql
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ storage
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ vpc
    â”‚Â Â  â”‚Â Â  â”‚Â Â      â”œâ”€â”€ main.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â      â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ variables.tf
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ provider.tf
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tfstate
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ terraform.tfvars
    â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf
    â”‚Â Â  â””â”€â”€ prod
    â”‚Â Â      â””â”€â”€ init
    â””â”€â”€ v3-k8s
        â””â”€â”€ init


```


### ë²„ì „ êµ¬ë¶„ ë°©ë²•
- ë²„ì „ì€ **ë””ë ‰í† ë¦¬**ë¡œ êµ¬ë¶„í•©ë‹ˆë‹¤.
- **v1**: **sftp**ë¥¼ ì´ìš©í•œ ìˆ˜ë™ ë°°í¬
- **v2**: **Docker + LoadBalancer** ê¸°ë°˜ í”„ë¡ íŠ¸ì—”ë“œ, ë°±ì—”ë“œ, AI ë°°í¬ + **Github Action**ì„ ì´ìš©í•œ **CI/CD** íŒŒì´í”„ë¼ì¸ êµ¬ì„±
- **v3**: **Terraform** ë°°í¬ + **Helm, ArgoCD**ë¥¼ ì´ìš©í•œ **CI/CD** íŒŒì´í”„ë¼ì¸ êµ¬ì„±

<br>

---

## ğŸ‘¥ ì‘ì—…ì ì •ë³´

| ì´ë¦„     | ë‹‰ë„¤ì„        | ì‚¬ì§„ |
|:----------|:----------------|:------|
| **ë‹‰ë„¤ì„** | `@jchanho99`   | `@pieceofizzy` |
| **ì‚¬ì§„** | <img src="https://github.com/jchanho99.png" width="100" height="100"/> | <img src="https://github.com/pieceofizzy.png" width="100" height="100"/> |

<br>

---

## ğŸ›  ì‚¬ìš© ìŠ¤íƒ & CLI ë²„ì „ ì •ë³´

- **Google Cloud SDK 526.0.1** 
- **Amazon Web Services (AWS)**
- **Terraform v1.12.2**, **Provider: google v6.35.0**

<br>

---

## ğŸ› ï¸ ì½”ë“œ ì‘ì„± ê·œì¹™ 
- **Terraform** ê³µì‹ í¬ë§·í„°ì¸ `terraform fmt`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œ ìŠ¤íƒ€ì¼ì„ í†µì¼í•©ë‹ˆë‹¤. 

### ë„¤ì´ë° ë°©ì‹
- ë“¤ì—¬ì“°ê¸°ëŠ” **2 spaces**ë¡œ í†µì¼í•œë‹¤. 
- ë„¤ì´ë°ì€ ëª¨ë‘ **foo-bar**ì˜ í˜•ì‹ì„ ì‚¬ìš©í•œë‹¤.
- ëª¨ë“  ë¦¬ì†ŒìŠ¤ì—ëŠ” **tag**ë¥¼  í•„ìˆ˜ ì‘ì„±í•œë‹¤.

### íƒœê·¸ ì§€ì • ë°©ì‹
```hcl
tags = {
  Name        = "leafresh-vpc"
  Project     = "leafresh"
  Environment = "prod"        # dev, prod ë“±ìœ¼ë¡œ êµ¬ë¶„
  Module      = "network"    # ëª¨ë“ˆëª… (network, compute, database, security, monitoring ë“±)
  Version     = "v2"         # Terraform ì½”ë“œ ë²„ì „
  Assignee    = "andrea"      # ì‘ì„±ì ì´ë¦„
}
```

<br>

---


## ğŸ“– í˜‘ì—… ë°©ì‹
- ë³€ê²½ì‚¬í•­ ë°œìƒ ì‹œ, **PR ì‘ì„± ë° ë¦¬ë·°**ë¥¼ ì§„í–‰í•œë‹¤.
- main ë¸Œëœì¹˜ ë³‘í•© ì „, **`terraform validate`** ë° **`terraform plan`**ë¥¼ ìˆ˜í–‰í•˜ì—¬ ë°°í¬ ì „ ë¬¸ì œ ë°œìƒ í™•ë¥ ì„ ë‚®ì¶˜ë‹¤.
- ëª¨ë“ˆ ì¶”ê°€/ìˆ˜ì • ì‹œ, **`README.md`** ë° ì˜ˆì‹œ ì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.


### Terraform Plan & Apply ì›Œí¬í”Œë¡œìš° 
1. ìµœì‹  ì½”ë“œ Pull
`git pull origin main`

2. ì½”ë“œ ìˆ˜ì • & í¬ë§· ì •ë¦¬
`terraform fmt`

3. ë¬¸ë²• ì²´í¬
`terraform validate`

4. ë³€ê²½ì‚¬í•­ í™•ì¸
`terraform plan`

5. PR ìƒì„± ë° Plan ê²°ê³¼ ì²¨ë¶€

6. ë¦¬ë·° ì™„ë£Œ í›„ Merge

7. ì‹¤ì œ ì ìš©
`terraform apply`


### PR ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸

| ì²´í¬ í•­ëª© | ì„¤ëª… |
|:----------|:-----|
| terraform fmt ì ìš© ì—¬ë¶€ | ì½”ë“œ í¬ë§·íŒ… ì ìš© í™•ì¸ |
| ë¦¬ì†ŒìŠ¤ íƒœê·¸ ì‚½ì… ì—¬ë¶€ | ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— íƒœê·¸ ì‚½ì… ì—¬ë¶€ í™•ì¸ |
| ë²„ì „ ëª…ì‹œ ì—¬ë¶€ | versions.tf íŒŒì¼ ì ì ˆíˆ ê´€ë¦¬ ì—¬ë¶€ í™•ì¸ |
| ë¯¼ê° ì •ë³´ ë…¸ì¶œ ì—¬ë¶€ | Secrets ì§ì ‘ ë…¸ì¶œ ë°©ì§€ ì—¬ë¶€ í™•ì¸ |
| ê°€ë…ì„± ë° ì¼ê´€ì„± | ë“¤ì—¬ì“°ê¸°, ì •ë ¬, ë¹ˆì¤„ í™•ì¸ |
| ë¦¬ì†ŒìŠ¤ ë„¤ì´ë° ê·œì¹™ ì¤€ìˆ˜ | 2ë‹¨ì–´ ì´ìƒ ì‚¬ìš© ì‹œ '-'ë¡œ ì‘ì„±í–ˆëŠ”ì§€ í™•ì¸ |
| ëª¨ë“ˆ ì‚¬ìš© ì—¬ë¶€ | ë¦¬ì†ŒìŠ¤ë¥¼ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³  moduleë¡œ ê°ìŒŒëŠ”ì§€ |
| outputs.tf ì‘ì„± ì—¬ë¶€ | ì£¼ìš” ì¶œë ¥ ê°’(outputs)ì„ ì •ì˜í–ˆëŠ”ì§€ |
| terraform plan ê²°ê³¼ ê²€í†  | ì˜ë„ì¹˜ ì•Šì€ ë¦¬ì†ŒìŠ¤ ì‚­ì œ/ë³€ê²½ ì—†ëŠ”ì§€ í™•ì¸ |
